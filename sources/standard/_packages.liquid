{% for package in context.packages %}
{% assign package_name = package.name | downcase | replace: ":", "" | replace: " ", "_" %}
{% capture equalsigns %}{% for count in (1..depth) %}={% endfor %}{% endcapture %}{{equalsigns}} {{ package.name }}
{{equalsigns}}= {{ package.name }}

{% capture requirement_filename %}requirements/requirements_class_{{ package_name }}{% endcapture %}
{% capture requirement_content %}{% include requirement_filename %}{% endcapture %}
{% unless requirement_content contains "Liquid error" %}
{{ requirement_content }}
{% endunless %}

{% for diagram in package.diagrams %}
{% if diagram.name == package.name %}
The UML diagram of the {{ package.name }} module is depicted in
<<{{ package_name }}-uml>>.
A detailed discussion of Requirements Class {{ package.name }}
can be found in the
link:http://docs.opengeospatial.org/DRAFTS/20-066.html#ug-model-{{ package_name }}-section[CityGML 3.0 Users Guide].

[[{{ package_name }}-uml]]
.UML diagram of the {{ package.name }} Model.

image::figures/{{ package.name }}.png[align="center"]

{% capture ade_types_image_name %}{{ package.name }} - ADE Data types{% endcapture %}
{{ ade_types_image_name }}
{% elsif diagram.name contains ade_types_image_name %}
The ADE data types provided for the {{ package.name }} module are
illustrated in <<{{ package_name }}-uml-ade-types>>.

[[{{ package_name }}-uml-ade-types]]
.ADE classes of the CityGML {{ package.name }} module.
image::figures/{{ package.name }}-ADE_Datatypes.png[]

{% capture codelists_image_name %}{{ package.name }} - Code lists{% endcapture %}
{{ codelists_image_name }}
{% elsif diagram.name contains codelists_image_name %}
The Code Lists provided for the {{ package.name }} module are
illustrated in <<{{ package_name }}-uml-codelists>>.

[[{{ package_name }}-uml-codelists]]
.Codelists from the CityGML {{ package.name }} module.
image::figures/{{ package.name }}-Codelists.png[]
{% endif %}
{% endfor %}

{% capture requirement_classes_filename %}requirements/{{ package_name }}/REQ_{{ package_name }}_Classes{% endcapture %}
{% capture requirement_classes_content %}{% include requirement_classes_filename %}{% endcapture %}
{% capture requirement_boundaries_filename %}requirements/{{ package_name }}/REQ_{{ package_name }}_Boundaries{% endcapture %}
{% capture requirement_boundaries_content %}{% include requirement_boundaries_filename %}{% endcapture %}
{% capture requirement_ade_use_filename %}requirements/{{ package_name }}/REQ_{{ package_name }}_ADE_Use{% endcapture %}
{% capture requirement_ade_use_content %}{% include requirement_ade_use_filename %}{% endcapture %}
{% unless requirement_classes_filename contains "Liquid error" and requirement_boundaries_content contains "Liquid error" and requirement_ade_use_content contains "Liquid error" %}
{{equalsigns}}= Requirements

{% unless requirement_classes_content contains "Liquid error" %}
The following requirement defines the rules governing implementation
of the CityGML Bridge Module as an Implementation Specification.

{{ requirement_classes_content }}
{% endunless %}
{% unless requirement_boundaries_content contains "Liquid error" %}
The implementation of this Module is further constrained by the
following spatial boundary requirement:

{{ requirement_boundaries_content }}
{% endunless %}
{% unless requirement_ade_use_content contains "Liquid error" %}
The use of extension capabilities by Bridge elements is constrained
by the following requirement:

{{ requirement_ade_use_content }}
{% endunless %}
{% endunless %}

{{equalsigns}}= Class Definitions
{% if package.classes.size > 0 %}
.Classes used in {{ package.name }}
[cols="2a,6a",options="header"]
|===
|Class |Description

{% for klass in package.classes %}
|<<P-{{ package.name }}-C-{{ klass.name }}-section,{{ klass.name }}>>
|{{ klass.definition }}

{% endfor %}
|===
{% endif %}

{% if package.data_types.size > 0 %}
.Data Types used in {{ package.name }}
[cols="2,6",options="header"]
|===
|Name |Description

{% for klass in package.data_types %}
|<<P-{{ package.name }}-DT-{{ klass.name }}-section,{{ klass.name }}>>
|{{ klass.definition }}

{% endfor %}

|===
{% endif %}

{% if package.enums.size > 0 %}
.Enumerated Classes used in {{ package.name }}
[cols="2a,6a",options="header"]
|===
|Name |Description

{% for klass in package.enums %}
|<<P-{{ package.name }}-E-{{ klass.name }}-section,{{ klass.name }}>>
|{{ klass.definition }}

{% endfor %}

|===
{% endif %}

{% if package.packages.size > 0 %}{% assign nested_depth = depth | plus: 1 %}
{% include "packages", depth: nested_depth, context: package %}
{% endif %}

{% endfor %}