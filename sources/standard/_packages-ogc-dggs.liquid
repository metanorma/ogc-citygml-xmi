{% for package in context.packages %}
{% assign is_package_spare = package.name | slice: 0,5 %}
{% if is_package_spare == 'old: ' %}{% continue %}
{% elsif is_package_spare == 'Spare' %}{% continue %}
{% endif %}
{% assign package_name = package.name | downcase | replace: ":", "" | replace: " ", "_" %}

{% capture equalsigns %}{% for count in (1..depth) %}={% endfor %}{% endcapture %}{{equalsigns}} {{ package.name }} package
{{equalsigns}}= {{ package.name }} overview

{% for diagram in package.diagrams %}
[[figure-{{ diagram.xmi_id }}]]
.{{ diagram.name }}
image::../../xmi-19170-only/Images/{{ diagram.xmi_id }}.png[]

{% if diagram.definition %}
{{ diagram.definition | html2adoc }}
{% endif %}
{% endfor %}

{% if package.packages.size > 0 %}The {{ package.name }} package is organized into
{{ package.packages.size }} packages{% assign modules_nested_size = 0 %}{% for module in package.packages %}{% assign modules_nested_size = modules_nested_size | plus: module.packages.size %}{% endfor %}{% if modules_nested_size > 0 %} with {{modules_nested_size}} modules{% endif %}:
{% endif %}
[arabic]
{% for module in package.packages %}
{% if module.packages.length > 0 %}
. {{ module.name }} package comprises:
{% for nested_module in module.packages %}
.. {{nested_module.name}} module
{% endfor %}
{% else %}
. {{ module.name }} package
{% endif %}
{% endfor %}

{% if package.classes.size > 0 %}

{{equalsigns}}= Defining tables

[arabic]
{% for klass in package.classes %}
{% assign is_klass_spare = klass.name | slice: 0,5 %}
{% if is_klass_spare == 'old: ' %}{% continue %}
{% elsif is_klass_spare == 'Spare' %}{% continue %}
{% endif %}
{% assign klass_name = klass.name | downcase | replace: ':', '' | replace: ' ', '_' %}
.<<tab-P-{{ package_name }}-C-{{ klass_name }}>> -- Elements of {{ package.name }}::{{ klass.name }}

{% endfor %}
{% for enum in package.enums %}
{% assign is_enum_spare = enum.name | slice: 0,5 %}
{% if is_enum_spare == 'old: ' %}{% continue %}
{% elsif is_enum_spare == 'Spare' %}{% continue %}
{% endif %}
{% assign enum_name = enum.name | downcase | replace: ':', '' | replace: ' ', '_' %}
.<<tab-P-{{ package_name }}-E-{{ enum_name }}>> -- Elements of {{ package.name }}::{{ enum.name }}

{% endfor %}
{% for data_type in package.data_types %}
{% assign is_data_type_spare = data_type.name | slice: 0,5 %}
{% if is_data_type_spare == 'old: ' %}{% continue %}
{% elsif is_data_type_spare == 'Spare' %}{% continue %}
{% endif %}
{% assign data_type_name = data_type.name | downcase | replace: ':', '' | replace: ' ', '_' %}
.<<tab-P-{{ package_name }}-DT-{{ data_type_name }}>> -- Elements of {{ package.name }}::{{ data_type.name }}

{% endfor %}

{% for klass in package.classes %}
{% include "packages_class" %}
{% endfor %}

{% for klass in package.enums %}
{% include "packages_enum" %}
{% endfor %}

{% for klass in package.data_types %}
{% include "packages_data_type" %}
{% endfor %}

{% capture requirement_filename %}requirements/REQ_{{ package_name }}{% endcapture %}
{% capture requirement_content %}{% include requirement_filename %}{% endcapture %}
{% unless requirement_content contains "Liquid error" %}
The following requirements apply:
{{ requirement_content }}

{% for num in (1..5) %}
{% capture nested_requirement_filename %}requirements/REQ_{{ package_name }}_{{num}}{% endcapture %}
{% capture nested_requirement_content %}{% include nested_requirement_filename %}{% endcapture %}
{% unless nested_requirement_content contains "Liquid error" %}
{{ nested_requirement_content }}
{% endunless %}
{% endfor %}
{% endunless %}

{% endif %}
{% if package.packages.size > 0 %}{% assign nested_depth = depth | plus: 1 %}{% include "packages", depth: nested_depth, context: package %}{% endif %}
{% endfor %}
